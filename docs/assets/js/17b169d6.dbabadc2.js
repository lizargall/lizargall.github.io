"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7305],{5641:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>n,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"adt/dataprovider","title":"Accessing Sensor Data","description":"The Project Aria Data Provider provides a customized way to retrieve and read data from VRS files in an intuitive and effective way.","source":"@site/docs/adt/dataprovider.mdx","sourceDirName":"adt","slug":"/adt/dataprovider","permalink":"/docs/adt/dataprovider","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"id":"dataprovider","title":"Accessing Sensor Data","description":"The Project Aria Data Provider provides a customized way to retrieve and read data from VRS files in an intuitive and effective way."},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/docs/adt/adt_overview"},"next":{"title":"Sensors and Measurements","permalink":"/docs/adt/sensors-measurements"}}');var i=r(4848),s=r(8453);const n={sidebar_position:10,id:"dataprovider",title:"Accessing Sensor Data",description:"The Project Aria Data Provider provides a customized way to retrieve and read data from VRS files in an intuitive and effective way."},o="Accessing Project Aria Sensor Data",d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Instructions",id:"instructions",level:2},{value:"1. Create an Aria Data Provider instance",id:"1-create-an-aria-data-provider-instance",level:3},{value:"2. Select your VRS file",id:"2-select-your-vrs-file",level:3},{value:"3. Set which sensor data the Project Aria Data Provider should read",id:"3-set-which-sensor-data-the-project-aria-data-provider-should-read",level:3},{value:"By high-level API",id:"by-high-level-api",level:4},{value:"Or by StreamId",id:"or-by-streamid",level:4},{value:"4.  Set whether to print data layouts (optional)",id:"4--set-whether-to-print-data-layouts-optional",level:3},{value:"5. Read the data stream",id:"5-read-the-data-stream",level:3},{value:"6. Access the data stream",id:"6-access-the-data-stream",level:3},{value:"7. Loading device model",id:"7-loading-device-model",level:3},{value:"How the Project Aria Data Provider works",id:"how-the-project-aria-data-provider-works",level:2},{value:"How Project Aria players are configured",id:"how-project-aria-players-are-configured",level:2},{value:"Project Aria <code>DataLayout</code> definitions",id:"project-aria-datalayout-definitions",level:2}];function l(e){const a={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.header,{children:(0,i.jsx)(a.h1,{id:"accessing-project-aria-sensor-data",children:"Accessing Project Aria Sensor Data"})}),"\n",(0,i.jsx)(a.admonition,{title:"Writing Sample",type:"info",children:(0,i.jsxs)(a.p,{children:["This page is an archive of technical writing I did for Project Aria. For the most up to date documentation go to ",(0,i.jsx)(a.a,{href:"https://facebookresearch.github.io/projectaria_tools/docs/intro",children:"Project Aria Docs"}),"."]})}),"\n",(0,i.jsx)(a.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(a.p,{children:["The Project Aria Data Provider provides a customized way to retrieve and read data from ",(0,i.jsx)(a.a,{href:"https://facebookresearch.github.io/vrs/docs/Overview/",children:"VRS"})," files in an intuitive and effective way."]}),"\n",(0,i.jsxs)(a.p,{children:["Project Aria data can also be loaded by reading VRS files directly, using ",(0,i.jsx)(a.a,{href:"https://facebookresearch.github.io/vrs/",children:"VRS tools"})," or other tools that leverage VRS APIs. This page contains instructions for the most common uses of Project Aria Data Provider and then describes how we have used VRS."]}),"\n",(0,i.jsx)(a.h2,{id:"instructions",children:"Instructions"}),"\n",(0,i.jsx)(a.p,{children:"Use the following commands in Python3 to retrieve and read sensor data from VRS."}),"\n",(0,i.jsx)(a.h3,{id:"1-create-an-aria-data-provider-instance",children:"1. Create an Aria Data Provider instance"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"import pyark.datatools as datatools\nvrs_data_provider = datatools.dataprovider.AriaVrsDataProvider()\n"})}),"\n",(0,i.jsx)(a.h3,{id:"2-select-your-vrs-file",children:"2. Select your VRS file"}),"\n",(0,i.jsx)(a.p,{children:"Enter the name (and path if you are in a different directory) for the VRS file you wish to read. Here it is represented as \u2018recording.vrs\u2019."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.openFile(\u2018recording.vrs\u2019)\n"})}),"\n",(0,i.jsx)(a.h3,{id:"3-set-which-sensor-data-the-project-aria-data-provider-should-read",children:"3. Set which sensor data the Project Aria Data Provider should read"}),"\n",(0,i.jsx)(a.h4,{id:"by-high-level-api",children:"By high-level API"}),"\n",(0,i.jsxs)(a.p,{children:["Use ",(0,i.jsx)(a.code,{children:"vrs_data_provider"})," to set which sensor stream/s the Aria Data Provider should read. The available sensor stream is constructed by ",(0,i.jsx)(a.code,{children:"set"}),(0,i.jsx)(a.em,{children:(0,i.jsx)(a.code,{children:"<streamType>"})}),(0,i.jsx)(a.code,{children:"Player"})]}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:["Go to ",(0,i.jsx)(a.a,{href:"/docs/adt/sensors-measurements",children:"Sensors and Measurements"})," for a list of all the stream types."]}),"\n"]}),"\n",(0,i.jsx)(a.p,{children:"This example is for SLAM left camera:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.setSlamLeftCameraPlayer()\n"})}),"\n",(0,i.jsx)(a.h4,{id:"or-by-streamid",children:"Or by StreamId"}),"\n",(0,i.jsxs)(a.p,{children:["Use the following commands if you wish to set this directly using the VRS ",(0,i.jsx)(a.a,{href:"https://github.com/facebookresearch/vrs/tree/main/vrs",children:"StreamId"}),"."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"slam_camera_recordable_type_id = 1201\nslam_left_camera_instance_id = 1\nslam_left_camera_stream_id = datatools.dataprovider.StreamId(slam_camera_recordable_type_id, slam_left_camera_instance_id)\nvrs_data_provider.setStreamPlayer(slam_left_camera_stream_id)\n"})}),"\n",(0,i.jsx)(a.h3,{id:"4--set-whether-to-print-data-layouts-optional",children:"4.  Set whether to print data layouts (optional)"}),"\n",(0,i.jsx)(a.p,{children:"By default data layouts are not printed while reading records. Set the verbosity to True to print data layouts and False to not print data layouts:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.setVerbose(True)\n"})}),"\n",(0,i.jsx)(a.h3,{id:"5-read-the-data-stream",children:"5. Read the data stream"}),"\n",(0,i.jsx)(a.p,{children:"All records in timestamp order:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.readAllRecords()\n# Output example:\n    # 4822.486 Camera Data (SLAM) #1 [1201-1]: jpg, 44338 bytes. # JPEG compressed image data size before decompression\n    # 4832.286 Camera Data (SLAM) #1 [1201-1]: jpg, 64148 bytes.\n    # 4832.386 Camera Data (SLAM) #1 [1201-1]: jpg, 64174 bytes.\n"})}),"\n",(0,i.jsx)(a.p,{children:"Read a single data record by timestamp:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.readDataRecordByTime(slam_left_camera_stream_id, someTimestamp)\n"})}),"\n",(0,i.jsx)(a.p,{children:"You can also use a higher level API that reads a data record in a specific stream and proceeds next timestamp in the player internally."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.tryFetchNextData(slam_left_camera_stream_id)\n"})}),"\n",(0,i.jsx)(a.h3,{id:"6-access-the-data-stream",children:"6. Access the data stream"}),"\n",(0,i.jsx)(a.p,{children:"Once you\u2019ve read and stored records in the players. All streams have configuration and data records."}),"\n",(0,i.jsx)(a.p,{children:"You can access:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"getConfigRecord()"})," -  one per stream."]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"getDataRecord()"})," - All streams use data records to store information"]}),"\n",(0,i.jsxs)(a.li,{children:[(0,i.jsx)(a.code,{children:"getData()"})," - Audio and image streams only. This accesses data from content blocks that contain raw image and audio data"]}),"\n"]}),"\n",(0,i.jsxs)(a.p,{children:["To find out what is in a configuration or data record, go to ",(0,i.jsx)(a.a,{href:"https://github.com/facebookresearch/vrs/tree/main/vrs/oss/aria",children:"vrs/vrs/oss/aria"}),". These definitions provide an overview of what information can be extracted for each stream from a Project Aria sequence."]}),"\n",(0,i.jsx)(a.p,{children:"In this example, one SLAM left camera data record is accessed. What is read is defined by the records loaded when setting how to read the data stream."}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"slam_left_camera_player = vrs_data_provider.getSlamLeftCameraPlayer()\nslam_left_camera_data_record = slam_left_camera_player.getDataRecord()\nslam_left_camera_data_record.captureTimestampNs\n# Output example\n    # 4832385508212\n"})}),"\n",(0,i.jsxs)(a.p,{children:["In this example  ",(0,i.jsx)(a.code,{children:"getData()"}),"  is used to get raw SLAM left camera data. Raw data is compressed into JPG formatting when it is read by the Aria visualization tool."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"slam_left_camera_data = slam_left_camera_player.getData()\npixel_frame = slam_left_camera_data.pixelFrame\nbuffer = pixel_frame.getBuffer()\nlen(buffer)\n# Output example:\n    # 307200 \n        # The JPEG image data decompressed internally in AriaImageSensorPlayer. The value is the SLAM camera image width (640) * image height(480)\n"})}),"\n",(0,i.jsxs)(a.p,{children:["In this example, ",(0,i.jsx)(a.code,{children:"getConfigRecord()"})," is used to read the configuration records for the SLAM left Camera."]}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"vrs_data_provider.readFirstConfigurationRecord(slam_left_camera_stream_id)\n"})}),"\n",(0,i.jsx)(a.h3,{id:"7-loading-device-model",children:"7. Loading device model"}),"\n",(0,i.jsx)(a.p,{children:"There are calibration strings for each image and motion stream. Reading the configuration record for any one of them will load the device model. Load the device model:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"slam_left_camera_stream_id = slam_left_camera_player.getStreamId()\nslam_left_camera_stream_id\n# Output example:\n# <pyark.datatools.dataprovider.StreamId object at 0x7f955808c270>\nvrs_data_provider.readFirstConfigurationRecord(slam_left_camera_stream_id)\n# True\nvrs_data_provider.loadDeviceModel()\n# True\ndevice_model = vrs_data_provider.getDeviceModel()\ndevice_model\n# <pyark.datatools.sensors.DeviceModel object at 0x7f955808c2b0>\n"})}),"\n",(0,i.jsx)(a.p,{children:"Then a 3D point from one sensor coordinate system can be transformed into another with:"}),"\n",(0,i.jsx)(a.pre,{children:(0,i.jsx)(a.code,{className:"language-python",children:"import numpy as np\np_slamLeft = np.array([3.0, 2.0, 1.0])\np_imuRight = device_model.transform(p_slamLeft, 'camera-slam-left', 'imu-right')\np_imuRight\n# array([ 3.32648252, -1.50695095, 1.10720445])\n"})}),"\n",(0,i.jsxs)(a.p,{children:["To find out more about Calibration go to ",(0,i.jsx)(a.a,{href:"https://facebookresearch.github.io/Aria_data_tools/docs/howto/calibration/",children:"Using Project Aria Calibration Sensor Data"})]}),"\n",(0,i.jsx)(a.h2,{id:"how-the-project-aria-data-provider-works",children:"How the Project Aria Data Provider works"}),"\n",(0,i.jsxs)(a.p,{children:["The Project Aria Data Provider uses  ",(0,i.jsx)(a.code,{children:"RecordFileReader"})," and ",(0,i.jsx)(a.code,{children:"StreamPlayer"})," classes to retrieve and read data from VRS files in an intuitive and effective way."]}),"\n",(0,i.jsxs)(a.p,{children:["Through the Project Aria Data Provider, a player is implemented for every Project Aria data stream. This player allows VRS configuration and data records to be stored and retrieved. The configuration and data record structure contents in each player are defined by the Project Aria ",(0,i.jsx)(a.code,{children:"DataLayout"})," definitions."]}),"\n",(0,i.jsx)(a.p,{children:"Project Aria VRS data provider class exposes the functionality needed to read and access Project Aria data intuitively. It enables:"}),"\n",(0,i.jsxs)(a.ul,{children:["\n",(0,i.jsx)(a.li,{children:"Project Aria players to be configured correctly (see below)"}),"\n",(0,i.jsx)(a.li,{children:"Retrieving players and accessing their latest content, and handling the VRS operations required for all these actions internally."}),"\n",(0,i.jsxs)(a.li,{children:["Utilizing the power of VRS tools for reading records via ",(0,i.jsx)(a.code,{children:"RecordFileReader"})," wrapper functions."]}),"\n"]}),"\n",(0,i.jsx)(a.h2,{id:"how-project-aria-players-are-configured",children:"How Project Aria players are configured"}),"\n",(0,i.jsxs)(a.p,{children:["So that data layouts of a stream can be read, a ",(0,i.jsx)(a.code,{children:"RecordFileStreamPlayer"})," instance for it has to be set in ",(0,i.jsx)(a.code,{children:"RecordFileReader"}),". Using custom classes for each stream type that inherit ",(0,i.jsx)(a.code,{children:"RecordFileStreamPlayer"})," allows reading configuration/data records in the VRS file by overriding ",(0,i.jsx)(a.code,{children:"RecordFileStreamPlayer::onDataLayoutRead"})," function. Project Aria players that follow this pattern are open sourced under ",(0,i.jsx)(a.code,{children:"src/dataprovider/players"}),"."]}),"\n",(0,i.jsx)(a.p,{children:"Each player header file contains configuration and data record structure definitions, matching their stream data layout definitions. There are getter methods in the player classes to retrieve these records."}),"\n",(0,i.jsxs)(a.h2,{id:"project-aria-datalayout-definitions",children:["Project Aria ",(0,i.jsx)(a.code,{children:"DataLayout"})," definitions"]}),"\n",(0,i.jsxs)(a.p,{children:["DataLayout definitions of the metadata blocks in Project Aria VRS files are open sourced under ",(0,i.jsx)(a.a,{href:"https://github.com/facebookresearch/vrs/tree/main/vrs/oss/aria",children:"vrs/vrs/oss/aria"}),". These definitions provide an overview of what information can be extracted for each stream from a Project Aria sequence."]})]})}function h(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,i.jsx)(a,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,a,r)=>{r.d(a,{R:()=>n,x:()=>o});var t=r(6540);const i={},s=t.createContext(i);function n(e){const a=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),t.createElement(s.Provider,{value:a},e.children)}}}]);